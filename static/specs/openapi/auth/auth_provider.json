{
  "openapi": "3.1.0",
  "info": {
    "title": "Rainbow Authentication Provider API",
    "description": "Rainbow Authentication Module - Rainbow Provider API",
    "version": "1.0.0"
  },
  "servers": [
    {
      "url": "http://127.0.0.1:1000",
      "description": "Testing server"
    }
  ],
  "tags": [
    {
      "name": "Wallet",
      "description": "Endpoints related to Wallet management"
    },
    {
      "name": "Consumer",
      "description": "Endpoints related to the Consumer interaction"
    },
    {
      "name": "OIDC4VP",
      "description": "Endpoints related to the verification of credentials"
    },
    {
      "name": "Mates",
      "description": "Endpoints related to all the Consumer that have registered successfully"
    }
  ],
  "paths": {
    "/api/v1/wallet/register": {
      "post": {
        "tags": ["Wallet"],
        "summary": "Register a new wallet",
        "description": "Creates a new wallet in the system.",
        "operationId": "wallet_register",
        "responses": {
          "201": {
            "description": "Wallet successfully registered."
          },
          "502": {
            "description": "The petition to the wallet went wrong"
          },
          "500": {
            "description": "Unexpected internal server error"
          }
        }
      }
    },
    "/api/v1/wallet/login": {
      "post": {
        "tags": ["Wallet"],
        "summary": "Login a wallet",
        "description": "Authenticates an existing wallet in the system.",
        "operationId": "wallet_login",
        "responses": {
          "200": {
            "description": "Wallet successfully logged in."
          },
          "502": {
            "description": "The petition to the wallet went wrong"
          },
          "500": {
            "description": "Unexpected internal server error"
          }
        }
      }
    },
    "/api/v1/wallet/logout": {
      "post": {
        "tags": ["Wallet"],
        "summary": "Logout a wallet",
        "description": "Logs out an authenticated wallet from the system.",
        "operationId": "wallet_logout",
        "responses": {
          "200": {
            "description": "Wallet successfully logged out."
          },
          "502": {
            "description": "The petition to the wallet went wrong"
          },
          "500": {
            "description": "Unexpected internal server error"
          }
        }
      }
    },
    "/api/v1/wallet/onboard": {
      "post": {
        "tags": ["Wallet"],
        "summary": "Onboard a wallet",
        "description": "Performs the onboarding process for a wallet in the system.",
        "operationId": "wallet_onboard",
        "responses": {
          "201": {
            "description": "Wallet successfully onboarded."
          },
          "502": {
            "description": "The petition to the wallet went wrong"
          },
          "500": {
            "description": "Unexpected internal server error"
          }
        }
      }
    },
    "/api/v1/wallet/partial-onboard": {
      "post": {
        "tags": ["Wallet"],
        "summary": "Partial onboard a wallet",
        "description": "Performs a partial onboarding process for a wallet in the system.",
        "operationId": "wallet_onboard",
        "responses": {
          "201": {
            "description": "Wallet successfully initialized."
          },
          "502": {
            "description": "The petition to the wallet went wrong"
          },
          "500": {
            "description": "Unexpected internal server error"
          }
        }
      }
    },
    "/api/v1/wallet/key": {
      "post": {
        "tags": ["Wallet"],
        "summary": "Register key in wallet",
        "description": "Register the key from env files in wallet.",
        "operationId": "register-key",
        "responses": {
          "201": {
            "description": "Key successfully registered."
          },
          "412": {
            "description": "An action should be done before"
          },
          "502": {
            "description": "The petition to create the key went wrong"
          },
          "500": {
            "description": "Unexpected internal server error"
          }
        }
      },
      "delete": {
        "tags": ["Wallet"],
        "summary": "Delete the key from wallet",
        "description": "Delete the key from wallet.",
        "operationId": "delete-key",
        "responses": {
          "201": {
            "description": "Key successfully deleted."
          },
          "412": {
            "description": "An action should be done before"
          },
          "502": {
            "description": "The petition to create the key went wrong"
          },
          "500": {
            "description": "Unexpected internal server error"
          }
        }
      }
    },
    "/api/v1/wallet/did": {
      "post": {
        "tags": ["Wallet"],
        "summary": "Register Did in wallet",
        "description": "Register Did based on key in wallet.",
        "operationId": "register-did",
        "responses": {
          "201": {
            "description": "Did successfully registered."
          },
          "412": {
            "description": "An action should be done before"
          },
          "502": {
            "description": "The petition to the create the Did went wrong"
          },
          "500": {
            "description": "Unexpected internal server error"
          }
        }
      },
      "delete": {
        "tags": ["Wallet"],
        "summary": "Delete Did from wallet",
        "description": "Delete Did from wallet.",
        "operationId": "delete-did",
        "responses": {
          "201": {
            "description": "Did successfully deleted."
          },
          "412": {
            "description": "An action should be done before"
          },
          "502": {
            "description": "The petition to the create the Did went wrong"
          },
          "500": {
            "description": "Unexpected internal server error"
          }
        }
      }
    },
    "/api/v1/did.json": {
      "get": {
        "tags": ["Wallet"],
        "summary": "Retrieve DID document",
        "description": "Gets the DID document of the wallet.",
        "operationId": "didweb",
        "responses": {
          "200": {
            "description": "DID document successfully retrieved.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "@context": {
                      "type": "string"
                    },
                    "id": {
                      "type": "string"
                    },
                    "verificationMethod": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string"
                          },
                          "type": {
                            "type": "string"
                          },
                          "controller": {
                            "type": "string"
                          },
                          "publicKeyBase58": {
                            "type": "string"
                          }
                        },
                        "required": [
                          "id",
                          "type",
                          "controller",
                          "publicKeyBase58"
                        ]
                      }
                    },
                    "authentication": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    }
                  },
                  "required": [
                    "@context",
                    "id",
                    "verificationMethod",
                    "authentication"
                  ]
                }
              }
            }
          },
          "412": {
            "description": "There is no wallet associated with the session or the Wallet does not have any dids."
          },
          "500": {
            "description": "Unexpected internal server error."
          }
        }
      }
    },
    "/api/v1/access": {
      "post": {
        "tags": ["Consumer"],
        "summary": "Initiate access request",
        "description": "Sends the initial GNAP access request.",
        "operationId": "access_request",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "access_token": {
                    "type": "object",
                    "properties": {
                      "access": {
                        "type": "object",
                        "properties": {
                          "type": {
                            "type": "string"
                          },
                          "actions": {
                            "type": "array",
                            "items": {
                              "type": "string"
                            }
                          },
                          "locations": {
                            "type": "array",
                            "items": {
                              "type": "string"
                            }
                          },
                          "datatypes": {
                            "type": "array",
                            "items": {
                              "type": "string"
                            }
                          },
                          "identifier": {
                            "type": "string"
                          },
                          "privileges": {
                            "type": "array",
                            "items": {
                              "type": "string"
                            }
                          }
                        },
                        "required": [
                          "type"
                        ]
                      },
                      "label": {
                        "type": "string"
                      },
                      "flags": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      }
                    },
                    "required": [
                      "access"
                    ]
                  },
                  "subject": {
                    "type": "object",
                    "properties": {
                      "sub_id_formats": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      },
                      "assertion_formats": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      },
                      "sub_ids": {
                        "type": "object"
                      }
                    }
                  },
                  "client": {
                    "type": "object"
                  },
                  "user": {
                    "type": "string"
                  },
                  "interact": {
                    "type": "object",
                    "properties": {
                      "start": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      },
                      "finish": {
                        "type": "object",
                        "properties": {
                          "method": {
                            "type": "string"
                          },
                          "uri": {
                            "type": "string"
                          },
                          "nonce": {
                            "type": "string"
                          },
                          "hash_method": {
                            "type": "string"
                          }
                        },
                        "required": [
                          "method",
                          "nonce"
                        ]
                      },
                      "hints": {
                        "type": "string"
                      }
                    },
                    "required": [
                      "start",
                      "finish"
                    ]
                  }
                },
                "required": [
                  "access_token",
                  "client",
                  "interact"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Grant request successfully created.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "continue": {
                      "type": "object",
                      "properties": {
                        "uri": {
                          "type": "string"
                        },
                        "wait": {
                          "type": "integer"
                        },
                        "access_token": {
                          "type": "object",
                          "properties": {
                            "access": {
                              "type": "object",
                              "properties": {
                                "type": {
                                  "type": "string"
                                },
                                "actions": {
                                  "type": "array",
                                  "items": {
                                    "type": "string"
                                  }
                                },
                                "locations": {
                                  "type": "array",
                                  "items": {
                                    "type": "string"
                                  }
                                },
                                "datatypes": {
                                  "type": "array",
                                  "items": {
                                    "type": "string"
                                  }
                                },
                                "identifier": {
                                  "type": "string"
                                },
                                "privileges": {
                                  "type": "array",
                                  "items": {
                                    "type": "string"
                                  }
                                }
                              },
                              "required": [
                                "type"
                              ]
                            },
                            "label": {
                              "type": "string"
                            },
                            "flags": {
                              "type": "array",
                              "items": {
                                "type": "string"
                              }
                            }
                          },
                          "required": [
                            "access"
                          ]
                        }
                      }
                    },
                    "subject": {
                      "type": "object",
                      "properties": {
                        "sub_id_formats": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        },
                        "assertion_formats": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        },
                        "sub_ids": {
                          "type": "object"
                        }
                      }
                    },
                    "instance_id": {
                      "type": "object"
                    },
                    "user": {
                      "type": "string"
                    },
                    "interact": {
                      "type": "object",
                      "properties": {
                        "start": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        },
                        "finish": {
                          "type": "object",
                          "properties": {
                            "method": {
                              "type": "string"
                            },
                            "uri": {
                              "type": "string"
                            },
                            "nonce": {
                              "type": "string"
                            },
                            "hash_method": {
                              "type": "string"
                            }
                          },
                          "required": [
                            "method",
                            "nonce"
                          ]
                        },
                        "hints": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "start",
                        "finish"
                      ]
                    }
                  },
                  "required": [
                    "continue",
                    "instance_id",
                    "interact"
                  ]
                }
              }
            }
          },
          "400": {
            "description": "The request was malformed."
          },
          "501": {
            "description": "Not implemented yet: request contains fields not yet handled."
          },
          "500": {
            "description": "Unexpected internal server error or database error."
          }
        }
      }
    },
    "/api/v1/continue/{id}": {
      "post": {
        "tags": ["Consumer"],
        "summary": "Continue GNAP request",
        "description": "Continues a GNAP access request using the interaction reference and Authorization token.",
        "operationId": "continue_request",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "description": "Request identifier",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "interact_ref": {
                    "type": "string"
                  }
                },
                "required": [
                  "interact_ref"
                ]
              }
            }
          }
        },
        "headers": {
          "Authorization": {
            "description": "GNAP access token, format: 'GNAP <token>'",
            "schema": {
              "type": "string"
            }
          }
        },
        "responses": {
          "200": {
            "description": "Access token successfully generated.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "value": {
                      "type": "string"
                    },
                    "label": {
                      "type": "string"
                    },
                    "manage": {
                      "type": "object"
                    },
                    "access": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    },
                    "expires_in": {
                      "type": "integer",
                      "format": "int64"
                    },
                    "key": {
                      "type": "object"
                    },
                    "flags": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    }
                  },
                  "required": [
                    "value",
                    "access"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized: missing or invalid Authorization token."
          },
          "404": {
            "description": "Request with given id not found."
          },
          "422": {
            "description": "Unprocessable entity: interact_ref or token does not match expected value."
          },
          "500": {
            "description": "Unexpected internal server error or database error."
          }
        }
      }
    },
    "/api/v1/pd/{state}": {
      "get": {
        "tags": ["OIDC4VP"],
        "summary": "Retrieve VP Definition",
        "description": "Generates and retrieves the Verifiable Presentation definition for the given state identifier.",
        "operationId": "pd",
        "parameters": [
          {
            "name": "state",
            "in": "path",
            "required": true,
            "description": "State identifier for the VP request",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Verifiable Presentation definition successfully generated.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "additionalProperties": true
                }
              }
            }
          },
          "404": {
            "description": "State not found: no VP Definition exists for the given identifier."
          },
          "500": {
            "description": "Unexpected internal server error or database error."
          }
        }
      }
    },
    "/api/v1/verify/{state}": {
      "post": {
        "tags": ["OIDC4VP"],
        "summary": "Verify VP Submission",
        "description": "Verifies the submitted Verifiable Presentation for a given state identifier.",
        "operationId": "verify",
        "parameters": [
          {
            "name": "state",
            "in": "path",
            "required": true,
            "description": "State identifier for the verification request",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/x-www-form-urlencoded": {
              "schema": {
                "type": "object",
                "properties": {
                  "vp_token": {
                    "type": "string"
                  },
                  "presentation_submission": {
                    "type": "string"
                  }
                },
                "required": [
                  "vp_token",
                  "presentation_submission"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Verification completed, returns URI if available.",
            "content": {
              "application/json": {
                "schema": {
                  "oneOf": [
                    {
                      "type": "string"
                    },
                    {
                      "type": "null"
                    }
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Bad request: malformed or missing fields."
          },
          "404": {
            "description": "State not found: no verification request exists for the given identifier."
          },
          "422": {
            "description": "Unprocessable entity: validation failed."
          },
          "500": {
            "description": "Unexpected internal server error or database error."
          }
        }
      }
    },
    "/api/v1/verify/mate/token": {
      "post": {
        "tags": ["Mates"],
        "summary": "Verify mate token",
        "description": "Verifies a mate token and returns the associated mate model if valid.",
        "operationId": "verify_mate_token",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "token": {
                    "type": "string"
                  }
                },
                "required": [
                  "token"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Model successfully verified and retrieved.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "participant_id": {
                      "type": "string"
                    },
                    "participant_slug": {
                      "type": "string"
                    },
                    "participant_type": {
                      "type": "string"
                    },
                    "base_url": {
                      "type": "string",
                      "nullable": true
                    },
                    "token": {
                      "type": "string",
                      "nullable": true
                    },
                    "saved_at": {
                      "type": "string",
                      "format": "date-time"
                    },
                    "last_interaction": {
                      "type": "string",
                      "format": "date-time"
                    },
                    "is_me": {
                      "type": "boolean"
                    }
                  },
                  "required": [
                    "participant_id",
                    "participant_slug",
                    "participant_type",
                    "saved_at",
                    "last_interaction",
                    "is_me"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized: invalid token."
          },
          "500": {
            "description": "Unexpected internal server error or database error."
          }
        }
      }
    },
    "/api/v1/retrieve/business/token": {
      "post": {
        "tags": ["Mates"],
        "summary": "Retrieve business mate token",
        "description": "Retrieves a business mate token using the auth request identifier.",
        "operationId": "retrieve_business_mate_token",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "authRequestId": {
                    "type": "string"
                  }
                },
                "required": [
                  "authRequestId"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Token and mate information successfully returned.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "token": {
                      "type": "string"
                    },
                    "mate": {
                      "type": "object",
                      "properties": {
                        "participant_id": {
                          "type": "string"
                        },
                        "participant_slug": {
                          "type": "string"
                        },
                        "participant_type": {
                          "type": "string"
                        },
                        "base_url": {
                          "type": "string",
                          "nullable": true
                        },
                        "token": {
                          "type": "string",
                          "nullable": true
                        },
                        "saved_at": {
                          "type": "string",
                          "format": "date-time"
                        },
                        "last_interaction": {
                          "type": "string",
                          "format": "date-time"
                        },
                        "is_me": {
                          "type": "boolean"
                        }
                      },
                      "required": [
                        "participant_id",
                        "participant_slug",
                        "participant_type",
                        "saved_at",
                        "last_interaction",
                        "is_me"
                      ]
                    }
                  },
                  "required": [
                    "token",
                    "mate"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized: missing or invalid token."
          },
          "404": {
            "description": "Auth request with given id not found."
          },
          "412": {
            "description": "Precondition failed: consumer has not completed onboarding."
          },
          "500": {
            "description": "Unexpected internal server error or database error."
          }
        }
      }
    },
    "/api/v1/business/login": {
      "post": {
        "tags": ["Mates"],
        "summary": "Fast business login",
        "description": "Performs a fast login for a business using the auth request identifier and returns a URI.",
        "operationId": "fast_login",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "authRequestId": {
                    "type": "string"
                  }
                },
                "required": [
                  "authRequestId"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Fast login completed successfully, returns URI.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "string",
                  "format": "uri"
                }
              }
            }
          },
          "500": {
            "description": "Unexpected internal server error or database error."
          }
        }
      }
    },
    "/api/v1/mates": {
      "get": {
        "summary": "List all mates",
        "description": "Retrieves a list of all mates associated with the authenticated user.",
        "operationId": "getAllMates",
        "responses": {
          "200": {
            "description": "List of mates successfully retrieved.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "participant_id": {
                        "type": "string"
                      },
                      "participant_slug": {
                        "type": "string"
                      },
                      "participant_type": {
                        "type": "string"
                      },
                      "base_url": {
                        "type": "string",
                        "nullable": true
                      },
                      "token": {
                        "type": "string",
                        "nullable": true
                      },
                      "saved_at": {
                        "type": "string",
                        "format": "date-time"
                      },
                      "last_interaction": {
                        "type": "string",
                        "format": "date-time"
                      },
                      "is_me": {
                        "type": "boolean"
                      }
                    },
                    "required": [
                      "participant_id",
                      "participant_slug",
                      "participant_type",
                      "saved_at",
                      "last_interaction",
                      "is_me"
                    ]
                  }
                }
              }
            }
          },
          "400": {
            "description": "Bad request: malformed request."
          },
          "404": {
            "description": "No mates found for the authenticated user."
          },
          "500": {
            "description": "Unexpected internal server error or database error."
          }
        }
      }
    },
    "/api/v1/mates/me": {
      "get": {
        "summary": "Get current user information",
        "description": "Retrieves the mate information for the authenticated user.",
        "operationId": "getMateMe",
        "responses": {
          "200": {
            "description": "Mate information successfully retrieved.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "participant_id": {
                      "type": "string"
                    },
                    "participant_slug": {
                      "type": "string"
                    },
                    "participant_type": {
                      "type": "string"
                    },
                    "base_url": {
                      "type": "string",
                      "nullable": true
                    },
                    "token": {
                      "type": "string",
                      "nullable": true
                    },
                    "saved_at": {
                      "type": "string",
                      "format": "date-time"
                    },
                    "last_interaction": {
                      "type": "string",
                      "format": "date-time"
                    },
                    "is_me": {
                      "type": "boolean"
                    }
                  },
                  "required": [
                    "participant_id",
                    "participant_slug",
                    "participant_type",
                    "saved_at",
                    "last_interaction",
                    "is_me"
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Bad request: malformed request."
          },
          "404": {
            "description": "Mate not found for the authenticated user."
          },
          "500": {
            "description": "Unexpected internal server error or database error."
          }
        }
      }
    },
    "/api/v1/mates/:did": {
      "get": {
        "summary": "Get mate by DID",
        "description": "Retrieves the mate information for a specific DID.",
        "operationId": "getMateByDID",
        "parameters": [
          {
            "name": "did",
            "in": "path",
            "required": true,
            "description": "Decentralized Identifier (DID) of the mate",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Mate information successfully retrieved.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "participant_id": {
                      "type": "string"
                    },
                    "participant_slug": {
                      "type": "string"
                    },
                    "participant_type": {
                      "type": "string"
                    },
                    "base_url": {
                      "type": "string",
                      "nullable": true
                    },
                    "token": {
                      "type": "string",
                      "nullable": true
                    },
                    "saved_at": {
                      "type": "string",
                      "format": "date-time"
                    },
                    "last_interaction": {
                      "type": "string",
                      "format": "date-time"
                    },
                    "is_me": {
                      "type": "boolean"
                    }
                  },
                  "required": [
                    "participant_id",
                    "participant_slug",
                    "participant_type",
                    "saved_at",
                    "last_interaction",
                    "is_me"
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Bad request: malformed request."
          },
          "404": {
            "description": "Mate not found for the given DID."
          },
          "500": {
            "description": "Unexpected internal server error or database error."
          }
        }
      }
    }
  }
}