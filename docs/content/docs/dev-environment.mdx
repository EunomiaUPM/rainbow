---
title: "Development environment"
description: "Rainbow environment for developers and testers"
---

## Rainbow Protocol: Local Development Deployment Guide

This document outlines the architecture, prerequisites, and steps required to deploy the Rainbow Protocol development environment. The setup utilizes Docker Compose for infrastructure persistence (Databases, Vault, Redis) and local Rust execution for the application logic.

## 1. Architecture Overview

The environment is isolated into three distinct logical stacks to simulate a real-world decentralized network.

### A. Provider Stack

* **Database:** PostgreSQL (Port `1400`).
* **Cache:** Redis (Port `6379`).
* **Secrets Manager:** HashiCorp Vault (Port `8201`).
* **Auto-Configuration:** Automates key generation and Vault unsealing.

### B. Consumer Stack

* **Database:** PostgreSQL (Port `1300`).
* **Cache:** Redis (Port `6380`).
* **Secrets Manager:** HashiCorp Vault (Port `8202`).

### C. Infrastructure & Authority

* **Identity Management:** Keycloak (Port `2000`).
* **Authority Service:** Rainbow Authority node (Port `1500`).
* **SSI Layer:** Walt.id Identity Suite (External Dependency).

---

## 2. Directory Structure

Ensure the project files are organized as follows:

```text
project-root/
├── waltid-identity/       # External SSI Dependency
├── docker-compose.yml     # Rainbow Infrastructure
├── rainbow-monolith/      # Rust Source Code
├── scripts/
│   └── bash/
│       └── dev.sh         # Application runner script
└── static/                # Persistent Data
    ├── environment/config/
    └── vault/

```

---

## 3. External Dependencies (Walt.id)

The entire authentication layer is based on the Self-Sovereign Identity (SSI) paradigm provided by **walt.id**. This stack must be deployed before starting the Rainbow services.

### Step 1: Clone and Configure

Clone the identity repository and navigate to the docker directory:

```bash
git clone https://github.com/walt-id/waltid-identity.git
cd waltid-identity/docker-compose

```

### Step 2: Linux Configuration (Required for Linux Users)

If you are running on Linux, you must ensure containers can resolve the host network.

1. Open the `.env` file in the current directory.
2. Change the `SERVICE_HOST` variable to point to the Docker host alias.

**Original:**

```dotenv
SERVICE_HOST=localhost

```

**Updated:**

```dotenv
SERVICE_HOST=host.docker.internal

```

### Step 3: Deploy SSI Stack

Deploy the wallet services:

```bash
docker compose up -d

```

---

## 4. Rainbow Deployment Steps

Once the walt.id stack is running, proceed with the main Rainbow infrastructure.

### Step 1: Start Infrastructure

Run the following command from the root directory where the Rainbow `docker-compose.yml` is located:

```bash
docker compose up -d

```

**Initialization Process:**

1. **Secret Generation:** Generates RSA keys and certificates in `../static/vault/<role>/secrets`.
2. **Vault Initialization:** Initializes Vault, unseals it, and generates the `vault.env` file.
3. **Path Injection:** Automatically populates `VAULT_PATH` with the host machine's absolute path.

### Step 2: Verify Initialization

Verify that the environment files have been generated correctly:

```bash
cat ../static/vault/provider/data/vault.env

```

Ensure `VAULT_ADDR` points to `http://127.0.0.1:8201` and `VAULT_PATH` contains the valid absolute path.

### Step 3: Run the Application

Use the provided `dev.sh` script to launch the application. This script loads the generated environment variables before executing Cargo.

**Usage:**

```bash
./scripts/bash/dev.sh <role> <command>

```

**Examples:**

* **Setup Provider:** `./scripts/bash/dev.sh provider setup`
* **Start Provider:** `./scripts/bash/dev.sh provider start`
* **Setup Consumer:** `./scripts/bash/dev.sh consumer setup`

---

## 5. Configuration Reference

### Docker Services & Ports

| Service | Component | Port (Host) | Credentials |
| --- | --- | --- | --- |
| **Provider** | PostgreSQL | `1400` | `ds_provider` |
|  | Vault | `8201` | Token in `vault.env` |
| **Consumer** | PostgreSQL | `1300` | `ds_consumer` |
|  | Vault | `8202` | Token in `vault.env` |
| **Infra** | Keycloak | `2000` | `admin` / `admin` |
|  | Authority | `1500` | Internal Config |
| **Walt.id** | Core API | *(Varies)* | See walt.id docs |

### Environment Variables

The `docker-compose.yml` automatically injects the **`VAULT_HOST_PATH`** variable using `${PWD}`. This ensures the Rust application on the host can locate certificates generated inside Docker without manual path configuration.