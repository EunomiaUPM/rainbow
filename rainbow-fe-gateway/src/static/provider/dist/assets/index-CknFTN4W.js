import{N as _,aw as k,r as d,G as B,n as G,j as e,B as h,F as L,ax as H,ay as A,az as E,aA as R,aB as z,aC as M,a as m,aD as V,aE as $,aF as J,aG as K,aH as U,aI as W,aJ as q,aK as Q,aL as X,aM as Y,aN as Z,I as ee,L as se}from"./index-omH1oWRl.js";import{a as ae,b as te}from"./datahub-catalog-queries-CGh16eOf.js";import{H as N}from"./heading-BXPqTu4h.js";import{T as ie,a as re,b as v,c as o,d as ne,e as c}from"./table-BwqLlQhv.js";import{D as le,a as oe,b as ce,c as de,d as me,e as pe}from"./drawer-DhPcwUCn.js";import{P as xe}from"./PolicyWrapperShow-BEncyVi0.js";import{A as he}from"./arrow-right-yeyo7jFN.js";import"./list-cTQVuLal.js";import"./trash-CtVCp9rW.js";const je=({catalogId:p,datasetId:r,closeDrawer:n})=>{const{mutateAsync:j,isPending:x}=_(),{data:t}=k(r),{data:l}=ae(r),{api_gateway:g}=d.useContext(B),[b,y]=d.useState(!1),[ue,C]=d.useState(null),[u,w]=d.useState([]),[D,I]=d.useState(null),f=G({defaultValues:{consumerParticipantId:"",id:r,catalog:p,target:r}}),{handleSubmit:S,control:P}=f,O=async a=>{if(y(a),a&&u.length===0)try{const i=(await Y(g)).filter(T=>T.participant_type=="Consumer");w(i)}catch(s){console.error("Failed to fetch participants:",s)}},F=async a=>{const s=t.find(i=>i["@id"]==a.id);await j({content:{consumerParticipantId:a.consumerParticipantId,offer:{"@id":s["@id"],"@type":"Offer",target:s.target,permission:s.permission==null||s.permission.length==0?null:s.permission,obligation:s.obligation==null||s.obligation.length==0?null:s.obligation,prohibition:s.prohibition==null||s.prohibition.length==0?null:s.prohibition,profile:s.profile}},api_gateway:g}),n(!0)};return e.jsxs("div",{className:"max-w-[500px] w-full px-6",children:[e.jsxs("div",{className:" flex gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-200 mb-1",children:" Selected catalog"}),e.jsx(h,{variant:"info",children:p.slice(14)})]}),e.jsx("div",{className:"h-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-200 mb-1",children:" Selected dataset"}),e.jsx(h,{variant:"info",children:l.name})]})]}),e.jsx("div",{className:"h-5"}),e.jsx(L,{...f,children:e.jsxs("form",{onSubmit:S(F),className:"space-y-6",children:[e.jsx(H,{control:P,name:"consumerParticipantId",render:({field:a})=>{var s;return e.jsxs(A,{children:[e.jsxs("div",{children:[e.jsx(E,{className:"text-gray-200 font-normal",children:"Consumer Participant Id"}),e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Select the ID of the consumer participant for the negotiation."})]}),e.jsxs("div",{children:[e.jsx(R,{children:e.jsxs(z,{open:b,onOpenChange:O,children:[e.jsx(M,{asChild:!0,children:e.jsxs(m,{variant:"outline",role:"combobox","aria-expanded":b,className:"w-full justify-between font-normal text-gray-300  transition-colors",children:[a.value?((s=u.find(i=>i.participant_id===a.value))==null?void 0:s.participant_id.slice(4,32))+"[...]":"Select participant...",e.jsx(V,{className:"ml-2 h-4 w-4 shrink-0 opacity-80"})]})}),e.jsx($,{className:"w-[--radix-popover-trigger-width] bg-background p-0",children:e.jsxs(J,{children:[e.jsx(K,{placeholder:"Search participant..."}),e.jsxs(U,{children:[e.jsx(W,{children:"No participants found."}),e.jsx(q,{children:u.map(i=>e.jsxs(Q,{value:i.participant_id,onSelect:()=>{a.onChange(i.participant_id),C(i),y(!1)},className:a.value===i.participant_id?"text-role-consumer font-medium":"",children:[i.participant_id.slice(4,32)+"[...]",e.jsxs("span",{className:"text-gray-400 ml-2 text-sm",children:["(",i.base_url,")"]})]},i.participant_id))})]})]})})]})}),e.jsx(X,{})]})]})}}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-200 ",children:" Policies"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Select the policy from the dataset that best matches your needs."}),e.jsx("div",{className:"flex flex-wrap gap-4 mt-3 mb-24",children:t&&t.map(a=>e.jsx("div",{className:D===a?" outline outline-offset-2 outline-secondary-500 rounded-[6px] ":"opacity-70",onClick:()=>{I(a),f.setValue("id",a["@id"])},children:e.jsx(xe,{policy:a})},a["@id"]))})]}),e.jsxs("div",{className:"flex gap-2 border-t fixed bottom-0  p-6 w-full bg-background border-white/30",style:{marginLeft:-48},children:[e.jsxs(m,{type:"submit",disabled:x,className:"w-48",children:["Submit Offer ",x&&e.jsx("span",{className:"ml-2",children:"..."})]}),e.jsx(m,{type:"reset",variant:"ghost",onClick:()=>n(!0),children:"Cancel"})]})]})})]})},Ie=()=>{const[p,r]=d.useState(null),{catalogId:n}=Z.useParams(),{data:j}=te(n),x=()=>r(null);return e.jsx("div",{className:"space-y-4 pb-4",children:e.jsxs("div",{children:[e.jsx(N,{level:"h5",children:"Datasets"}),e.jsx("div",{className:"pb-3 w-3/5",children:e.jsx(ee,{type:"search"})}),e.jsxs(ie,{className:"text-sm",children:[e.jsx(re,{children:e.jsxs(v,{className:"",children:[e.jsx(o,{children:"Name"}),e.jsx(o,{children:"ETL system"}),e.jsx(o,{children:"Description"}),e.jsx(o,{children:"Glossary"}),e.jsx(o,{children:"Offer"}),e.jsx(o,{children:"Link"})]})}),e.jsx(ne,{children:j.map(t=>e.jsxs(v,{children:[e.jsx(c,{className:"min-w-[196px] max-w-[300px] break-all",children:t.name}),e.jsx(c,{children:e.jsx(h,{variant:"info",children:t.platform.name})}),e.jsx(c,{className:"min-w-[200px]",children:e.jsxs("p",{className:"text-xs",children:[" ",t.description.length>70?t.description.slice(0,70)+"...":t.description," "]})}),e.jsx(c,{children:e.jsx(h,{className:"default",children:t.glossary_terms.map(l=>e.jsx("span",{children:l.glossaryTermInfo.name},l.urn))})}),e.jsx(c,{children:e.jsxs(le,{direction:"right",open:p===t.urn,onOpenChange:l=>{l||r(null)},children:[e.jsx(oe,{asChild:!0,children:e.jsx(m,{variant:"outline",size:"sm",onClick:()=>r(t.urn),children:"+ Offer dataset"})}),e.jsxs(ce,{children:[e.jsx(de,{children:e.jsx(me,{asChild:!0,children:e.jsx(N,{level:"h5",className:"text-current",children:"New Contract Negotiation Offer"})})}),e.jsx(pe,{className:"items-start",children:e.jsx(je,{catalogId:n,datasetId:t.urn,closeDrawer:x})})]})]})}),e.jsx(c,{children:e.jsx(se,{to:"/datahub-catalog/$catalogId/dataset/$datasetId",params:{catalogId:n,datasetId:t.urn},children:e.jsxs(m,{variant:"link",children:["See dataset",e.jsx(he,{})]})})})]},t.urn))})]})]})})};export{Ie as component};
