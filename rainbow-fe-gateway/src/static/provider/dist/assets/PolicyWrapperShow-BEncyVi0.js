import{e as b,f as D,aO as L,n as S,r as h,G as C,j as e,D as P,o as I,p as E,s as R,B as x,F as T,t as _,v as q,a as d,aP as F,aQ as O,u as Q,x as v,y as w,h as f}from"./index-omH1oWRl.js";import{L as V,a as g,b as y}from"./list-cTQVuLal.js";import{H as N}from"./heading-BXPqTu4h.js";import{T as k}from"./trash-CtVCp9rW.js";const H=async({api_gateway:s,datasetId:t,catalogId:n,policyId:a})=>{await fetch(s+`/catalogs/${n}/datasets/${t}/policies/${a}`,{method:"DELETE"})},M=()=>{const s=b(),{data:t,isSuccess:n,isError:a,error:l,mutate:i,mutateAsync:r,isPending:u}=D({mutationFn:H,onMutate:async()=>{},onError:o=>{console.log("onError"),console.log(o)},onSuccess:async(o,c)=>{console.log("onSuccess"),await s.refetchQueries(["POLICIES_BY_DATASET_ID"])},onSettled:()=>{}});return{data:t,isSuccess:n,isError:a,error:l,mutate:i,mutateAsync:r,isPending:u}},$=async({content:s,api_gateway:t})=>await(await fetch(t+"/negotiation/rpc/request",{headers:{"Content-Type":"application/json"},body:JSON.stringify(s),method:"POST"})).json(),G=()=>{const s=b(),t=L(),{data:n,isSuccess:a,isError:l,error:i,mutate:r,mutateAsync:u,isPending:o}=D({mutationFn:$,onMutate:async()=>{},onError:c=>{console.log("onError"),console.log(c)},onSuccess:async(c,m)=>{console.log("onSuccess"),await s.refetchQueries(["CN_REQUESTS"]),await t.navigate({to:"/customer-requests"})},onSettled:()=>{}});return{data:n,isSuccess:a,isError:l,error:i,mutate:r,mutateAsync:u,isPending:o}},J=({policy:s,catalogId:t,datasetId:n})=>{const a=S({}),{handleSubmit:l,control:i,setValue:r,getValues:u}=a,{mutateAsync:o}=M(),{api_gateway:c}=h.useContext(C),m=()=>{o({api_gateway:c,catalogId:t,datasetId:n,policyId:s["@id"]})};return e.jsxs(P,{className:"max-w-fit sm:max-w-fit ",children:[e.jsxs(I,{children:[e.jsx(E,{children:"Delete policy dialog"}),e.jsx(R,{className:"max-w-full flex flex-wrap break-all",children:e.jsxs("span",{className:"max-w-full flex flex-wrap",children:["Are you sure you want to delete Policy with ID"," ",e.jsx(x,{variant:"info",children:s["@id"].slice(9,29)+"[...]"})]})})]}),e.jsx(T,{...a,children:e.jsx("form",{onSubmit:l(m),className:"space-y-6",children:e.jsxs(_,{className:"[&>*]:w-full",children:[e.jsx(q,{asChild:!0,children:e.jsx(d,{variant:"ghost",type:"reset",children:"Cancel"})}),e.jsx(d,{variant:"destructive",type:"submit",children:"Remove policy"})]})})})]})},Y=({policy:s,catalogId:t,datasetId:n,datasetName:a})=>{const l=h.useRef(null),i=S({}),{handleSubmit:r,control:u,setValue:o,getValues:c}=i,{mutateAsync:m}=G(),{api_gateway:A}=h.useContext(C),{participant:j}=h.useContext(F),B=async()=>{var p;await m({api_gateway:A,content:{consumerParticipantId:j==null?void 0:j.participant_id,offer:{"@id":s["@id"]}}}),i.reset(),(p=l.current)==null||p.click()};return e.jsxs(P,{className:" p-0 flex flex-col h-fit max-h-[90dvh]",children:[e.jsxs(I,{className:"px-6 pt-6",children:[e.jsx(E,{children:"Dataset access dialog"}),e.jsx(R,{className:"max-w-full flex flex-col break-all gap-2",children:e.jsx("span",{className:"max-w-full flex flex-col gap-0 mb-0",children:e.jsxs("span",{children:[" ","You are about to request access to dataset",e.jsx(x,{variant:"infoLighter",className:"mx-1 mt-1",children:a}),"in catalog"," ",e.jsx(x,{variant:"infoLighter",className:"mx-1 mt-1",children:t.slice(14)}),"under policy with ID"," ",e.jsx(x,{variant:"infoLighter",className:"mx-1 mt-1",children:s["@id"].slice(9,27)+"[...]"})]})})})]}),e.jsx(O,{children:e.jsx(z,{policy:s,datasetId:void 0,catalogId:void 0,participant:void 0,datasetName:""})}),e.jsx(T,{...i,children:e.jsx("form",{onSubmit:r(B),className:"space-y-6",children:e.jsxs(_,{className:"[&>*]:w-full p-6 pt-0",children:[e.jsx(q,{asChild:!0,ref:l,children:e.jsx(d,{variant:"ghost",type:"reset",children:"Cancel"})}),e.jsx(d,{variant:"default",type:"submit",children:"Request access"})]})})})]})},z=({policy:s,datasetId:t,catalogId:n,participant:a,datasetName:l})=>{const i=Q();return e.jsx("div",{className:"",children:e.jsxs(V,{className:"h-full flex flex-col items-start justify-start border border-white/30 bg-white/10 px-4 pb-4 pt-2 rounded-md ",children:[e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsxs(N,{level:"h5",className:"flex gap-3",children:[e.jsx("div",{children:"Policy with ID"}),e.jsx(x,{variant:"info",className:"h-6",children:s["@id"].slice(9,24)+"[...]"})]}),i.location.pathname.includes("datahub-catalog")?i.location.pathname.includes("dataset")?e.jsx(e.Fragment,{children:(a==null?void 0:a.participant_type)==="Provider"&&e.jsxs(v,{children:[e.jsx(w,{asChild:!0,children:e.jsx(d,{variant:"icon_destructive",size:"icon",className:"mb-2",children:e.jsx(k,{className:"mb-0.5"})})}),e.jsx(J,{policy:s,catalogId:n,datasetId:t})]})}):null:""]}),e.jsxs(g,{children:[e.jsx(y,{children:"Policy Target"}),e.jsx("p",{children:s["@type"]})]}),e.jsxs(g,{children:[e.jsx(y,{children:" Profile"}),e.jsxs("p",{className:"whitespace-normal",children:[" ",JSON.stringify(s.profile)]})]}),e.jsxs(g,{children:[e.jsx(y,{children:" Target"}),e.jsxs("p",{children:[" ",s.target.slice(9)]})]}),e.jsx("div",{className:"h-5"}),e.jsx(N,{level:"h6",children:" ODRL CONTENT"}),e.jsxs("div",{className:"flex flex-col gap-2 w-full",children:[e.jsx(f,{policyItem:s.permission,variant:"permission"}),e.jsx(f,{policyItem:s.prohibition,variant:"prohibition"}),e.jsx(f,{policyItem:s.obligation,variant:"obligation"})]}),e.jsx("div",{className:"h-4"}),(a==null?void 0:a.participant_type)==="Consumer"&&e.jsxs(v,{children:[e.jsx(w,{asChild:!0,children:e.jsx(d,{children:"Request dataset with Policy"})}),e.jsx(Y,{policy:s,catalogId:n,datasetId:t,datasetName:l})]})]})})};export{z as P};
