import{e as b,f as D,N as L,i as S,r as h,G as C,j as e,D as P,s as I,t as E,v as R,F as T,w as B,x as _,B as d,aL as F,aM as O,u as M,H as w,y as N,z as v}from"./index-BAHtZRt5.js";import{L as Q,a as f,b as g}from"./list-jggyKCr8.js";import{B as x}from"./badge-DhRbdQWa.js";import{P as y}from"./PolicyComponent-BqMrEILi.js";import{T as V}from"./trash-D768vGVp.js";const k=async({api_gateway:s,datasetId:a,catalogId:i,policyId:t})=>{await fetch(s+`/catalogs/${i}/datasets/${a}/policies/${t}`,{method:"DELETE"})},H=()=>{const s=b(),{data:a,isSuccess:i,isError:t,error:l,mutate:n,mutateAsync:r,isPending:u}=D({mutationFn:k,onMutate:async()=>{},onError:o=>{console.log("onError"),console.log(o)},onSuccess:async(o,c)=>{console.log("onSuccess"),await s.refetchQueries(["POLICIES_BY_DATASET_ID"])},onSettled:()=>{}});return{data:a,isSuccess:i,isError:t,error:l,mutate:n,mutateAsync:r,isPending:u}},$=async({content:s,api_gateway:a})=>await(await fetch(a+"/negotiation/rpc/request",{headers:{"Content-Type":"application/json"},body:JSON.stringify(s),method:"POST"})).json(),z=()=>{const s=b(),a=L(),{data:i,isSuccess:t,isError:l,error:n,mutate:r,mutateAsync:u,isPending:o}=D({mutationFn:$,onMutate:async()=>{},onError:c=>{console.log("onError"),console.log(c)},onSuccess:async(c,m)=>{console.log("onSuccess"),await s.refetchQueries(["CN_REQUESTS"]),await a.navigate({to:"/customer-requests"})},onSettled:()=>{}});return{data:i,isSuccess:t,isError:l,error:n,mutate:r,mutateAsync:u,isPending:o}},G=({policy:s,catalogId:a,datasetId:i})=>{const t=S({}),{handleSubmit:l,control:n,setValue:r,getValues:u}=t,{mutateAsync:o}=H(),{api_gateway:c}=h.useContext(C),m=()=>{o({api_gateway:c,catalogId:a,datasetId:i,policyId:s["@id"]})};return e.jsxs(P,{className:"max-w-fit sm:max-w-fit ",children:[e.jsxs(I,{children:[e.jsx(E,{children:"Delete policy dialog"}),e.jsx(R,{className:"max-w-full flex flex-wrap break-all",children:e.jsxs("span",{className:"max-w-full flex flex-wrap",children:["Are you sure you want to delete Policy with ID"," ",e.jsx(x,{variant:"info",children:s["@id"].slice(9,29)+"[...]"})]})})]}),e.jsx(T,{...t,children:e.jsx("form",{onSubmit:l(m),className:"space-y-6",children:e.jsxs(B,{className:"[&>*]:w-full",children:[e.jsx(_,{asChild:!0,children:e.jsx(d,{variant:"ghost",type:"reset",children:"Cancel"})}),e.jsx(d,{variant:"destructive",type:"submit",children:"Remove policy"})]})})})]})},J=({policy:s,catalogId:a,datasetId:i,datasetName:t})=>{const l=h.useRef(null),n=S({}),{handleSubmit:r,control:u,setValue:o,getValues:c}=n,{mutateAsync:m}=z(),{api_gateway:q}=h.useContext(C),{participant:j}=h.useContext(F),A=async()=>{var p;await m({api_gateway:q,content:{consumerParticipantId:j==null?void 0:j.participant_id,offer:{"@id":s["@id"]}}}),n.reset(),(p=l.current)==null||p.click()};return e.jsxs(P,{className:" p-0 flex flex-col h-fit max-h-[90dvh]",children:[e.jsxs(I,{className:"px-6 pt-6",children:[e.jsx(E,{children:"Dataset access dialog"}),e.jsx(R,{className:"max-w-full flex flex-col break-all gap-2",children:e.jsx("span",{className:"max-w-full flex flex-col gap-0 mb-0",children:e.jsxs("span",{children:[" ","You are about to request access to dataset",e.jsx(x,{variant:"infoLighter",className:"mx-1 mt-1",children:t}),"in catalog"," ",e.jsx(x,{variant:"infoLighter",className:"mx-1 mt-1",children:a.slice(14)}),"under policy with ID"," ",e.jsx(x,{variant:"infoLighter",className:"mx-1 mt-1",children:s["@id"].slice(9,27)+"[...]"})]})})})]}),e.jsx(O,{children:e.jsx(Y,{policy:s,datasetId:void 0,catalogId:void 0,participant:void 0,datasetName:""})}),e.jsx(T,{...n,children:e.jsx("form",{onSubmit:r(A),className:"space-y-6",children:e.jsxs(B,{className:"[&>*]:w-full p-6 pt-0",children:[e.jsx(_,{asChild:!0,ref:l,children:e.jsx(d,{variant:"ghost",type:"reset",children:"Cancel"})}),e.jsx(d,{variant:"default",type:"submit",children:"Request access"})]})})})]})},Y=({policy:s,datasetId:a,catalogId:i,participant:t,datasetName:l})=>{const n=M();return e.jsx("div",{className:"",children:e.jsxs(Q,{className:"h-full flex flex-col items-start justify-start border border-white/30 bg-white/10 px-4 pb-4 pt-2 rounded-md ",children:[e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsxs(w,{level:"h5",className:"flex gap-3",children:[e.jsx("div",{children:"Policy with ID"}),e.jsx(x,{variant:"info",className:"h-6",children:s["@id"].slice(9,24)+"[...]"})]}),n.location.pathname.includes("datahub-catalog")?n.location.pathname.includes("dataset")?e.jsx(e.Fragment,{children:(t==null?void 0:t.participant_type)==="Provider"&&e.jsxs(N,{children:[e.jsx(v,{asChild:!0,children:e.jsx(d,{variant:"icon_destructive",size:"icon",className:"mb-2",children:e.jsx(V,{className:"mb-0.5"})})}),e.jsx(G,{policy:s,catalogId:i,datasetId:a})]})}):null:""]}),e.jsxs(f,{children:[e.jsx(g,{children:"Policy Target"}),e.jsx("p",{children:s["@type"]})]}),e.jsxs(f,{children:[e.jsx(g,{children:" Profile"}),e.jsxs("p",{className:"whitespace-normal",children:[" ",JSON.stringify(s.profile)]})]}),e.jsxs(f,{children:[e.jsx(g,{children:" Target"}),e.jsxs("p",{children:[" ",s.target.slice(9)]})]}),e.jsx("div",{className:"h-5"}),e.jsx(w,{level:"h6",children:" ODRL CONTENT"}),e.jsxs("div",{className:"flex flex-col gap-2 w-full",children:[e.jsx(y,{policyItem:s.permission,variant:"permission"}),e.jsx(y,{policyItem:s.prohibition,variant:"prohibition"}),e.jsx(y,{policyItem:s.obligation,variant:"obligation"})]}),e.jsx("div",{className:"h-4"}),(t==null?void 0:t.participant_type)==="Consumer"&&e.jsxs(N,{children:[e.jsx(v,{asChild:!0,children:e.jsx(d,{children:"Request dataset with Policy"})}),e.jsx(J,{policy:s,catalogId:i,datasetId:a,datasetName:l})]})]})})};export{Y as P};
