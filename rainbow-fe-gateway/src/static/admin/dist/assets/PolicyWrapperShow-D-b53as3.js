import{r as f,j as e,a4 as C}from"./ui-B_Y8HlyQ.js";import{G as w,_ as N,B as x,f as g,t as P,D as j,l as v,a as b,P as h}from"./index-2IBXBLVr.js";import{I as S}from"./info-list-CzLp-cMe.js";import{H as E}from"./heading-Dyo69VqW.js";import{g as p,h as D,u as R,a as A}from"./tanstack-CQsG9zHS.js";import{u as d,B as I,t as q}from"./infoItemMappers-CT53hr-5.js";const B=async({api_gateway:s,datasetId:a,catalogId:o,policyId:t})=>{await fetch(s+`/catalogs/${o}/datasets/${a}/policies/${t}`,{method:"DELETE"})},T=()=>{const s=p(),{data:a,isSuccess:o,isError:t,error:i,mutate:r,mutateAsync:l,isPending:n}=D({mutationFn:B,onMutate:async()=>{},onError:c=>{console.log("onError"),console.log(c)},onSuccess:async(c,u)=>{console.log("onSuccess"),await s.refetchQueries(["POLICIES_BY_DATASET_ID"])},onSettled:()=>{}});return{data:a,isSuccess:o,isError:t,error:i,mutate:r,mutateAsync:l,isPending:n}},_=async({content:s,api_gateway:a})=>await(await fetch(a+"/negotiation/rpc/request",{headers:{"Content-Type":"application/json"},body:JSON.stringify(s),method:"POST"})).json(),L=()=>{const s=p(),a=R(),{data:o,isSuccess:t,isError:i,error:r,mutate:l,mutateAsync:n,isPending:c}=D({mutationFn:_,onMutate:async()=>{},onError:u=>{console.log("onError"),console.log(u)},onSuccess:async(u,y)=>{console.log("onSuccess"),await s.refetchQueries(["CN_REQUESTS"]),await a.navigate({to:"/customer-requests"})},onSettled:()=>{}});return{data:o,isSuccess:t,isError:i,error:r,mutate:l,mutateAsync:n,isPending:c}},O=({policy:s,catalogId:a,datasetId:o})=>{const{mutateAsync:t}=T(),{api_gateway:i}=f.useContext(w),r=[d("Policy ID",s["@id"]),d("Catalog ID",a),d("Dataset ID",o)].filter(n=>n!==void 0),l=async()=>{await t({api_gateway:i,catalogId:a,datasetId:o,policyId:s["@id"]})};return e.jsx(I,{title:"Delete Policy",description:"Are you sure you want to delete this policy? This action cannot be undone.",infoItems:r,submitLabel:"Remove Policy",submitVariant:"destructive",onSubmit:l})},Q=({policy:s,catalogId:a,datasetId:o,datasetName:t})=>{const i=f.useRef(null),{mutateAsync:r}=L(),{api_gateway:l}=f.useContext(w),{participant:n}=f.useContext(N),c=[q("Dataset",t),d("Catalog ID",a),d("Policy ID",s["@id"])].filter(m=>m!==void 0),u=async()=>{var m;await r({api_gateway:l,content:{consumerParticipantId:n==null?void 0:n.participant_id,offer:{"@id":s["@id"]}}}),(m=i.current)==null||m.click()},y=e.jsxs("div",{className:"pt-4",children:[e.jsx(M,{policy:s,datasetId:void 0,catalogId:void 0,participant:void 0,datasetName:""}),e.jsx(P,{ref:i,className:"hidden"})]});return e.jsx(I,{title:"Request Dataset Access",description:e.jsxs("span",{className:"max-w-full flex flex-col gap-1",children:["You are about to request access to dataset"," ",e.jsx(x,{variant:"infoLighter",children:t})," ","in catalog"," ",e.jsx(x,{variant:"infoLighter",children:g(a)})," ","under policy"," ",e.jsx(x,{variant:"infoLighter",children:g(s["@id"])})]}),infoItems:c,afterInfoContent:y,submitLabel:"Request Access",submitVariant:"default",onSubmit:u,scrollable:!0})},M=({policy:s,datasetId:a,catalogId:o,participant:t,datasetName:i})=>{const r=A(),l=r.location.pathname.includes("datahub-catalog")&&r.location.pathname.includes("dataset"),n=(t==null?void 0:t.participant_type)==="Provider",c=(t==null?void 0:t.participant_type)==="Consumer";return e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"flex flex-col items-start justify-start border border-white/10 bg-white/5 p-3 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center w-full mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Policy ID"}),e.jsx(x,{variant:"info",className:"font-mono text-[10px]",children:g(s.id)})]}),l&&n&&e.jsxs(j,{children:[e.jsx(v,{asChild:!0,children:e.jsx(b,{variant:"ghost",size:"icon",className:"h-6 w-6 text-muted-foreground hover:text-destructive transition-colors",children:e.jsx(C,{className:"h-4 w-4"})})}),e.jsx(O,{policy:s,catalogId:o,datasetId:a})]})]}),e.jsx(S,{className:"w-full mb-3",items:[{label:"Policy Target",value:s.entityType},{label:"Target",value:s.entity.slice(9)}]}),e.jsxs("div",{className:"w-full space-y-2",children:[e.jsx(E,{level:"h6",className:"text-muted-foreground/70 mb-1",children:"ODRL Content"}),e.jsxs("div",{className:"flex flex-col gap-2 w-full",children:[e.jsx(h,{policyItem:s.odrlOffer.permission,variant:"permission"}),e.jsx(h,{policyItem:s.odrlOffer.prohibition,variant:"prohibition"}),e.jsx(h,{policyItem:s.odrlOffer.obligation,variant:"obligation"})]})]}),c&&e.jsx("div",{className:"mt-4 w-full flex justify-end",children:e.jsxs(j,{children:[e.jsx(v,{asChild:!0,children:e.jsx(b,{size:"sm",variant:"default",className:"w-full sm:w-auto",children:"Request Access"})}),e.jsx(Q,{policy:s,catalogId:o,datasetId:a,datasetName:i})]})})]})})};export{M as P};
