import{g as A,h as H}from"./tanstack-CQsG9zHS.js";import{r as I,j as e,a4 as P,a3 as S}from"./ui-B_Y8HlyQ.js";import{S as C,d as y,e as f,f as N,l as O,g as w,h as R,o as _,a as V,b as T,c as E,A as b}from"./index-BYPG5sgh.js";import{I as U,a as u}from"./index-BIgPSPD9.js";const k=async({content:l,datasetId:a,api_gateway:i})=>await(await fetch(i+`/datasets/${a}/policies`,{headers:{"Content-Type":"application/json"},body:l.offer,method:"POST"})).json(),$=()=>{const l=A(),{data:a,isSuccess:i,isError:t,error:p,mutate:m,mutateAsync:x,isPending:c}=H({mutationFn:k,onMutate:async()=>{},onError:d=>{console.log("onError"),console.log(d)},onSuccess:async(d,h)=>{console.log("onSuccess"),await l.refetchQueries(["POLICIES_BY_DATASET_ID",h.datasetId])},onSettled:()=>{}});return{data:a,isSuccess:i,isError:t,error:p,mutate:m,mutateAsync:x,isPending:c}},z=l=>{const[a,i]=I.useState({obligation:[],permission:[],prohibition:[]});return{policy:a,addComponent:n=>{const s={action:"",constraint:[]},o={...a};o[n].push(s),i(o)},removeComponent:(n,s)=>{const o={...a};o[n].splice(s,1),i(o)},addConstraint:(n,s)=>{const o={...a};o[n][s].constraint.push({leftOperand:"",operator:"",rightOperand:""}),i(o)},removeConstraint:(n,s,o)=>{const r={...a};r[n][s].constraint.splice(o,1),i(r)},updateField:(n,s,o)=>{const r={...a};r[n][s].action=o,i(r)},updateOperand:(n,s,o,r,g)=>{const j={...a};j[n][s].constraint[o][r]=g,i(j)},resetPolicy:()=>{i({permission:[],obligation:[],prohibition:[]})}}},D=({constraint:l,onUpdate:a,onRemove:i})=>e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs("div",{className:"constraint-create mb-2 flex gap-3 justify-end items-end",children:[e.jsx(C,{value:l.leftOperand,onValueChange:t=>a("leftOperand",t),children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"Left Operand:"}),e.jsx(y,{className:"w-[180px]",children:e.jsx(f,{placeholder:"Select item"})}),e.jsx(N,{children:O.map(t=>e.jsx(w,{value:t,children:t},t))})]})}),e.jsx(C,{value:l.operator,onValueChange:t=>a("operator",t),children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"Operator:"}),e.jsx(y,{className:"w-[140px]",children:e.jsx(f,{placeholder:"Select operator"})}),e.jsx(N,{children:R.map(t=>e.jsx(w,{value:t,children:t},t))})]})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"Right Operand:"}),e.jsx(U,{placeholder:"Type value",value:l.rightOperand,onChange:t=>a("rightOperand",t.currentTarget.value)})]}),e.jsx("div",{children:e.jsx(u,{variant:"icon_destructive",size:"icon",onClick:i,children:e.jsx(P,{className:"mb-0.5"})})})]})}),F=({item:l,typeLabel:a,onRemove:i,onUpdateAction:t,onAddConstraint:p,onRemoveConstraint:m,onUpdateConstraint:x})=>e.jsx("div",{children:e.jsxs("div",{className:"policy-item-create",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("p",{className:"mb-2",children:"Action:"}),e.jsxs(u,{variant:"icon_destructive",size:"xs",className:"ml-4",onClick:i,children:[e.jsx(P,{className:"mb-0.5"}),"Remove ",a]})]}),e.jsxs(C,{value:l.action,onValueChange:t,children:[e.jsx(y,{className:"w-[240px]",children:e.jsx(f,{placeholder:"Select action"})}),e.jsx(N,{children:_.map(c=>e.jsx(w,{value:c,children:c},c))})]}),e.jsx("div",{className:"h-6"}),e.jsx("p",{className:"mb-2",children:"Constraints:"}),l.constraint.map((c,d)=>e.jsx(D,{constraint:c,onRemove:()=>m(d),onUpdate:(h,n)=>x(d,h,n)},d)),e.jsxs(u,{size:"xs",variant:"outline",className:"mt-3",onClick:p,children:[e.jsx(S,{}),"Add constraint"]})]})}),v=({type:l,items:a,accordionValue:i,accordionStyles:t,triggerStyles:p,onAdd:m,onRemove:x,onUpdateAction:c,onAddConstraint:d,onRemoveConstraint:h,onUpdateConstraint:n})=>e.jsxs(V,{value:i,className:t,children:[e.jsx(T,{className:`${p} text-white/70 flex uppercase overflow-hidden rounded-md data-[state=open]:rounded-b-none`,children:e.jsx("div",{className:"flex items-center w-full",children:e.jsx("p",{className:"text-current",children:l})})}),e.jsxs(E,{className:"relative",children:[e.jsxs(u,{className:"border-b border-white/15",variant:"outline",size:"xs",onClick:m,children:[e.jsx(S,{}),"Add ",l]}),a.map((s,o)=>e.jsx(F,{item:s,typeLabel:l,onRemove:()=>x(o),onUpdateAction:r=>c(o,r),onAddConstraint:()=>d(o),onRemoveConstraint:r=>h(o,r),onUpdateConstraint:(r,g,j)=>n(o,r,g,j)},o))]})]}),q=({onSubmit:l})=>{const{policy:a,addComponent:i,removeComponent:t,addConstraint:p,removeConstraint:m,updateField:x,updateOperand:c,resetPolicy:d}=z(),h=()=>{l(a),d()};return e.jsxs("div",{className:"h-screen flex flex-col",children:[e.jsxs("div",{className:"flex flex-col gap-3 overflow-y-scroll h-[calc(100vh-180px)]  p-8 ",children:[e.jsx(b,{type:"single",collapsible:!0,className:"w-full",children:e.jsx(v,{type:"permission",items:a.permission,accordionValue:"item-1",accordionStyles:"bg-success-500/10 border border-success-600/20",triggerStyles:"bg-success-400/25",onAdd:()=>i("permission"),onRemove:n=>t("permission",n),onUpdateAction:(n,s)=>x("permission",n,s),onAddConstraint:n=>p("permission",n),onRemoveConstraint:(n,s)=>m("permission",n,s),onUpdateConstraint:(n,s,o,r)=>c("permission",n,s,o,r)})}),e.jsx(b,{type:"single",collapsible:!0,className:"w-full",children:e.jsx(v,{type:"obligation",items:a.obligation,accordionValue:"item-1",accordionStyles:"bg-warn-500/10 border border-warn-600/20",triggerStyles:"bg-warn-400/25",onAdd:()=>i("obligation"),onRemove:n=>t("obligation",n),onUpdateAction:(n,s)=>x("obligation",n,s),onAddConstraint:n=>p("obligation",n),onRemoveConstraint:(n,s)=>m("obligation",n,s),onUpdateConstraint:(n,s,o,r)=>c("obligation",n,s,o,r)})}),e.jsx(b,{type:"single",collapsible:!0,className:"w-full",children:e.jsx(v,{type:"prohibition",items:a.prohibition,accordionValue:"item-1",accordionStyles:"bg-danger-500/10 border border-danger-600/20 mb-24",triggerStyles:"bg-danger-500/25",onAdd:()=>i("prohibition"),onRemove:n=>t("prohibition",n),onUpdateAction:(n,s)=>x("prohibition",n,s),onAddConstraint:n=>p("prohibition",n),onRemoveConstraint:(n,s)=>m("prohibition",n,s),onUpdateConstraint:(n,s,o,r)=>c("prohibition",n,s,o,r)})})]}),e.jsx("div",{className:"h-24  bottom-0 bg-background border-t border-white/30 w-full p-6",children:e.jsx(u,{onClick:()=>h(),children:"Add policy"})})]})};export{q as P,$ as u};
