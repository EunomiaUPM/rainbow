import{r as o,j as e,a2 as B}from"./ui-B_Y8HlyQ.js";import{L as G}from"./tanstack-CQsG9zHS.js";import{v as F,U as H,V as L,G as R,n as _,B as p,F as A,W as E,a as x,X as V,Y as W,Z as $,I as z}from"./index-2IBXBLVr.js";import{H as y}from"./heading-Dyo69VqW.js";import{T as U,a as X,b as v,c,d as Y,e as l}from"./table-BSsU55pF.js";import{D as Z,a as q,b as J,c as K,d as M,e as Q}from"./drawer-DEO1_NxH.js";import{P as ee}from"./PolicyWrapperShow-D-b53as3.js";import"./vendor-BtP0CW_r.js";import"./syntax-Deq619ix.js";import"./info-list-CzLp-cMe.js";import"./dayjs.min-C1qovwV9.js";import"./infoItemMappers-CT53hr-5.js";const se=({catalogId:d,datasetId:i,closeDrawer:n})=>{const{mutateAsync:h,isPending:m}=F(),{data:s}=H(i),{data:r}=L(i),{api_gateway:f}=o.useContext(R),[N,g]=o.useState(!1),[ae,w]=o.useState(null),[b,C]=o.useState([]),[P,S]=o.useState(null),u=_({defaultValues:{consumerParticipantId:"",id:i,catalog:d,target:i}}),{handleSubmit:D,control:O}=u,T=async t=>{if(g(t),t&&b.length===0)try{const j=(await V(f)).filter(k=>k.participant_type=="Consumer");C(j)}catch(a){console.error("Failed to fetch participants:",a)}},I=async t=>{const a=s.find(j=>j["@id"]==t.id);await h({content:{consumerParticipantId:t.consumerParticipantId,offer:{"@id":a["@id"],"@type":"Offer",target:a.target,permission:a.permission==null||a.permission.length==0?void 0:a.permission,obligation:a.obligation==null||a.obligation.length==0?void 0:a.obligation,prohibition:a.prohibition==null||a.prohibition.length==0?void 0:a.prohibition,profile:a.profile}},api_gateway:f}),n(!0)};return e.jsxs("div",{className:"max-w-[500px] w-full px-6",children:[e.jsxs("div",{className:" flex gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-200 mb-1",children:" Selected catalog"}),e.jsx(p,{variant:"info",children:d.slice(14)})]}),e.jsx("div",{className:"h-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-200 mb-1",children:" Selected dataset"}),e.jsx(p,{variant:"info",children:r.name})]})]}),e.jsx("div",{className:"h-5"}),e.jsx(A,{...u,children:e.jsxs("form",{onSubmit:D(I),className:"space-y-6",children:[e.jsx(E,{control:O,name:"consumerParticipantId",participants:b,isOpen:N,onOpenChange:T,onSelect:t=>{w(t),g(!1)}}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-200 ",children:" Policies"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Select the policy from the dataset that best matches your needs."}),e.jsx("div",{className:"flex flex-wrap gap-4 mt-3 mb-24",children:s&&s.map(t=>e.jsx("div",{className:P===t?" outline outline-offset-2 outline-secondary-500 rounded-[6px] ":"opacity-70",onClick:()=>{S(t),u.setValue("id",t["@id"])},children:e.jsx(ee,{policy:t,datasetId:i,catalogId:d,datasetName:(r==null?void 0:r.name)||"",participant:void 0})},t["@id"]))})]}),e.jsxs("div",{className:"flex gap-2 border-t fixed bottom-0  p-6 w-full bg-background border-white/30",style:{marginLeft:-48},children:[e.jsxs(x,{type:"submit",disabled:m,className:"w-48",children:["Submit Offer ",m&&e.jsx("span",{className:"ml-2",children:"..."})]}),e.jsx(x,{type:"reset",variant:"ghost",onClick:()=>n(!0),children:"Cancel"})]})]})})]})},ue=()=>{const[d,i]=o.useState(null),{catalogId:n}=W.useParams(),{data:h}=$(n),m=()=>i(null);return e.jsx("div",{className:"space-y-4 pb-4",children:e.jsxs("div",{children:[e.jsx(y,{level:"h5",children:"Datasets"}),e.jsx("div",{className:"pb-3 w-3/5",children:e.jsx(z,{type:"search"})}),e.jsxs(U,{className:"text-sm",children:[e.jsx(X,{children:e.jsxs(v,{className:"",children:[e.jsx(c,{children:"Name"}),e.jsx(c,{children:"ETL system"}),e.jsx(c,{children:"Description"}),e.jsx(c,{children:"Glossary"}),e.jsx(c,{children:"Offer"}),e.jsx(c,{children:"Link"})]})}),e.jsx(Y,{children:h.map(s=>e.jsxs(v,{children:[e.jsx(l,{className:"min-w-[196px] max-w-[300px] break-all",children:s.name}),e.jsx(l,{children:e.jsx(p,{variant:"info",children:s.platform.name})}),e.jsx(l,{className:"min-w-[200px]",children:e.jsxs("p",{className:"text-xs",children:[" ",s.description.length>70?s.description.slice(0,70)+"...":s.description," "]})}),e.jsx(l,{children:e.jsx(p,{className:"default",children:s.glossary_terms.map(r=>e.jsx("span",{children:r.glossaryTermInfo.name},r.urn))})}),e.jsx(l,{children:e.jsxs(Z,{direction:"right",open:d===s.urn,onOpenChange:r=>{r||i(null)},children:[e.jsx(q,{asChild:!0,children:e.jsx(x,{variant:"outline",size:"sm",onClick:()=>i(s.urn),children:"+ Offer dataset"})}),e.jsxs(J,{children:[e.jsx(K,{children:e.jsx(M,{asChild:!0,children:e.jsx(y,{level:"h5",className:"text-current",children:"New Contract Negotiation Offer"})})}),e.jsx(Q,{className:"items-start",children:e.jsx(se,{catalogId:n,datasetId:s.urn,closeDrawer:m})})]})]})}),e.jsx(l,{children:e.jsx(G,{to:"/datahub-catalog/$catalogId/dataset/$datasetId",params:{catalogId:n,datasetId:s.urn},children:e.jsxs(x,{variant:"link",children:["See dataset",e.jsx(B,{})]})})})]},s.urn))})]})]})})};export{ue as component};
