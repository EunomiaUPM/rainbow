import{d as V,e as I,r as E,j as e,a as r,I as C}from"./index-Ebtqv1AD.js";import{A as O,a as S,b as P,c as A,S as d,d as x,e as h,f as m,o as _,g as p,l as k,h as T}from"./index-DptIB99U.js";import{P as u}from"./plus-D0vqfoS-.js";import{T as v}from"./trash-CCXyes8v.js";const H=async({content:b,datasetId:n,api_gateway:t})=>await(await fetch(t+`/datasets/${n}/policies`,{headers:{"Content-Type":"application/json"},body:b.offer,method:"POST"})).json(),M=()=>{const b=V(),{data:n,isSuccess:t,isError:j,error:N,mutate:g,mutateAsync:f,isPending:w}=I({mutationFn:H,onMutate:async()=>{},onError:o=>{console.log("onError"),console.log(o)},onSuccess:async(o,y)=>{console.log("onSuccess"),await b.refetchQueries(["POLICIES_BY_DATASET_ID",y.datasetId])},onSettled:()=>{}});return{data:n,isSuccess:t,isError:j,error:N,mutate:g,mutateAsync:f,isPending:w}},Q=({onSubmit:b})=>{const[n,t]=E.useState({obligation:[],permission:[],prohibition:[]}),j=c=>{const a={action:"",constraint:[]},s={...n};s[c].push(a),t(s),console.log(n)},N=(c,a)=>{const s={...n};s[c].splice(a,1),console.log(s),t(s),console.log(n)},g=(c,a)=>{const s={...n};s[c][a].constraint.push({leftOperand:"",operator:"",rightOperand:""}),t(s),console.log(n)},f=(c,a,s)=>{const i={...n};i[c][a].constraint.splice(s,1),t(i),console.log(n)},w=(c,a,s)=>{const i={...n};i[c][a].action=s,t(i),console.log(n)},o=(c,a,s,i,l)=>{const z={...n};z[c][a].constraint[s][i]=l,t(z),console.log(n)},y=()=>{b(n),t({permission:[],obligation:[],prohibition:[]})};return e.jsxs("div",{className:"h-screen flex flex-col",children:[e.jsxs("div",{className:"flex flex-col gap-3 overflow-y-scroll h-[calc(100vh-180px)]  p-8 ",children:[e.jsx(O,{type:"single",collapsible:!0,className:"w-full",children:e.jsxs(S,{value:"item-1",className:"bg-success-500/10 border border-success-600/20",children:[e.jsx(P,{className:"text-white/70 flex bg-success-400/25 uppercase overflow-hidden rounded-md data-[state=open]:rounded-b-none",children:e.jsx("div",{className:"flex items-center w-full",children:e.jsx("p",{className:"text-current",children:"permission"})})}),e.jsxs(A,{className:"relative",children:[e.jsxs(r,{className:"border-b border-white/15",policy:"permission",variant:"outline",size:"xs",onClick:()=>j("permission"),children:[e.jsx(u,{}),"Add permission"]}),n.permission.map((c,a)=>e.jsx("div",{children:e.jsxs("div",{className:"policy-item-create",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("p",{className:"mb-2",children:" Action: "}),e.jsxs(r,{variant:"icon_destructive",size:"xs",className:"ml-4 ",onClick:()=>N("permission",a),children:[e.jsx(v,{className:"mb-0.5"}),"Remove permission"]})]}),e.jsxs(d,{value:c.action,onValueChange:s=>w("permission",a,s),children:[e.jsx(x,{className:"w-[240px]",children:e.jsx(h,{placeholder:"Select action"})}),e.jsx(m,{children:_.map(s=>e.jsx(p,{value:s,children:s}))})]}),e.jsx("div",{className:"h-6"}),e.jsx("p",{className:"mb-2",children:" Constraints: "}),c.constraint.map((s,i)=>e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs("div",{className:"constraint-create mb-2 flex gap-3 justify-end items-end",children:[e.jsx(d,{value:s.leftOperand,onValueChange:l=>o("permission",a,i,"leftOperand",l),children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"Left Operand:"}),e.jsx(x,{className:"w-[180px]",children:e.jsx(h,{placeholder:"Select item"})}),e.jsx(m,{children:k.map(l=>e.jsx(p,{value:l,children:l}))})]})}),e.jsx(d,{value:s.operator,onValueChange:l=>o("permission",a,i,"operator",l),children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"Operator:"}),e.jsx(x,{className:"w-[140px]",children:e.jsx(h,{placeholder:"Select operator"})}),e.jsx(m,{children:T.map(l=>e.jsx(p,{value:l,children:l}))})]})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"Right Operand:"}),e.jsx(C,{placeholder:"Type value",value:s.rightOperand,onChange:l=>o("permission",a,i,"rightOperand",l.currentTarget.value)})]}),e.jsx("div",{children:e.jsx(r,{variant:"icon_destructive",size:"icon",onClick:()=>f("permission",a,i),children:e.jsx(v,{className:"mb-0.5 "})})})]})})),e.jsxs(r,{size:"xs",variant:"outline",className:"mt-3",onClick:()=>g("permission",a),children:[e.jsx(u,{}),"Add constraint"]})]})}))]})]})}),e.jsx(O,{type:"single",collapsible:!0,className:"w-full",children:e.jsxs(S,{value:"item-1",className:"bg-warn-500/10 border border-warn-600/20",children:[e.jsx(P,{className:"text-white/70 flex bg-warn-400/25 uppercase overflow-hidden rounded-md data-[state=open]:rounded-b-none",children:e.jsx("div",{className:"flex items-center w-full",children:e.jsx("p",{className:"text-current",children:"obligation"})})}),e.jsxs(A,{className:"relative",children:[e.jsxs(r,{className:"border-b border-white/15",policy:"obligation",variant:"outline",size:"xs",onClick:()=>j("obligation"),children:[e.jsx(u,{}),"Add obligation"]}),n.obligation.map((c,a)=>e.jsx("div",{children:e.jsxs("div",{className:"policy-item-create",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("p",{className:"mb-2",children:" Action: "}),e.jsxs(r,{variant:"icon_destructive",size:"xs",className:"ml-4",onClick:()=>N("obligation",a),children:[e.jsx(v,{className:"mb-0.5"}),"Remove obligation"]})]}),e.jsxs(d,{value:c.action,onValueChange:s=>w("obligation",a,s),children:[e.jsx(x,{className:"w-[240px]",children:e.jsx(h,{placeholder:"Select action"})}),e.jsx(m,{children:_.map(s=>e.jsx(p,{value:s,children:s}))})]}),e.jsx("div",{className:"h-6"}),e.jsx("p",{className:"mb-2",children:" Constraints: "}),c.constraint.map((s,i)=>e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs("div",{className:"constraint-create mb-2 flex gap-3 justify-end items-end",children:[e.jsx(d,{value:s.leftOperand,onValueChange:l=>o("obligation",a,i,"leftOperand",l),children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"Left Operand:"}),e.jsx(x,{className:"w-[180px]",children:e.jsx(h,{placeholder:"Select item"})}),e.jsx(m,{children:k.map(l=>e.jsx(p,{value:l,children:l}))})]})}),e.jsx(d,{value:s.operator,onValueChange:l=>o("obligation",a,i,"operator",l),children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"Operator:"}),e.jsx(x,{className:"w-[140px]",children:e.jsx(h,{placeholder:"Select operator"})}),e.jsx(m,{children:T.map(l=>e.jsx(p,{value:l,children:l}))})]})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"Right Operand:"}),e.jsx(C,{placeholder:"Type value",value:s.rightOperand,onChange:l=>o("obligation",a,i,"rightOperand",l.currentTarget.value)})]}),e.jsx("div",{children:e.jsx(r,{variant:"icon_destructive",size:"icon",onClick:()=>f("obligation",a,i),children:e.jsx(v,{className:"mb-0.5"})})})]})})),e.jsxs(r,{size:"xs",variant:"outline",className:"mt-3",onClick:()=>g("obligation",a),children:[e.jsx(u,{}),"Add constraint"]})]})}))]})]})}),e.jsx(O,{type:"single",collapsible:!0,className:"w-full",children:e.jsxs(S,{value:"item-1",className:"bg-danger-500/10 border border-danger-600/20 mb-24",children:[e.jsx(P,{className:"text-white/70 flex bg-danger-500/25 uppercase overflow-hidden rounded-md data-[state=open]:rounded-b-none",children:e.jsx("div",{className:"flex items-center w-full",children:e.jsx("p",{className:"text-current",children:" prohibition "})})}),e.jsxs(A,{className:"relative",children:[e.jsxs(r,{className:"border-b border-white/15",policy:"prohibition",variant:"outline",size:"xs",onClick:()=>j("prohibition"),children:[e.jsx(u,{}),"Add prohibition"]}),n.prohibition.map((c,a)=>e.jsx("div",{children:e.jsxs("div",{className:"policy-item-create",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("p",{className:"mb-2",children:" Action: "}),e.jsxs(r,{variant:"icon_destructive",size:"xs",className:"ml-4",onClick:()=>N("prohibition",a),children:[e.jsx(v,{className:"mb-0.5"}),"Remove prohibition"]})]}),e.jsxs(d,{value:c.action,onValueChange:s=>w("prohibition",a,s),children:[e.jsx(x,{className:"w-[240px]",children:e.jsx(h,{placeholder:"Select action"})}),e.jsx(m,{children:_.map(s=>e.jsx(p,{value:s,children:s}))})]}),e.jsx("div",{className:"h-6"}),e.jsx("p",{className:"mb-2",children:" Constraints: "}),c.constraint.map((s,i)=>e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs("div",{className:"constraint-create flex gap-3 justify-end items-end mb-2",children:[e.jsx(d,{value:s.leftOperand,onValueChange:l=>o("prohibition",a,i,"leftOperand",l),children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"Left Operand:"}),e.jsx(x,{className:"w-[180px]",children:e.jsx(h,{placeholder:"Select item"})}),e.jsx(m,{children:k.map(l=>e.jsx(p,{value:l,children:l}))})]})}),e.jsx(d,{value:s.operator,onValueChange:l=>o("prohibition",a,i,"operator",l),children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"Operator:"}),e.jsx(x,{className:"w-[140px]",children:e.jsx(h,{placeholder:"Select operator"})}),e.jsx(m,{children:T.map(l=>e.jsx(p,{value:l,children:l}))})]})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"Right Operand:"}),e.jsx(C,{value:s.rightOperand,placeholder:"Type value",onChange:l=>o("prohibition",a,i,"rightOperand",l.currentTarget.value)})]}),e.jsx("div",{children:e.jsx(r,{variant:"icon_destructive",size:"icon",onClick:()=>f("prohibition",a,i),children:e.jsx(v,{className:"mb-0.5"})})})]})})),e.jsxs(r,{size:"xs",variant:"outline",className:"mt-3",onClick:()=>g("prohibition",a),children:[e.jsx(u,{}),"Add constraint"]})]})}))]})]})})]}),e.jsx("div",{className:"h-24  bottom-0 bg-background border-t border-white/30 w-full p-6",children:e.jsx(r,{onClick:()=>y(),children:"Add policy"})})]})};export{Q as P,M as u};
