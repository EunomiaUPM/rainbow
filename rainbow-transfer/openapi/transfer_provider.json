{
  "openapi": "3.1.1",
  "info": {
    "title": "Transfer Process Protocol - Rainbow Provider API",
    "description": "Transfer Process Protocol - Rainbow Provider API",
    "version": "1.0.0"
  },
  "servers": [
    {
      "url": "http://127.0.0.1:1234",
      "description": "Testing server"
    }
  ],
  "tags": [
    {
      "name": "Transfer Process",
      "description": "Transfer Process Protocol related routes"
    },
    {
      "name": "Rainbow",
      "description": "Entities API in system"
    },
    {
      "name": "Provider",
      "description": "Routes from Provider"
    },
    {
      "name": "RPC",
      "description": "Routes for sending and processing Ds protocol message"
    }
  ],
  "paths": {
    "/api/v1/transfers": {
      "get": {
        "summary": "Retrieves all transfer processes in provider",
        "operationId": "rainbow_entities/get_all_transfers",
        "tags": [
          "Transfer Process",
          "Provider",
          "Rainbow"
        ],
        "security": [],
        "description": "",
        "responses": {
          "200": {
            "description": "Retrieves all transfer processes in provider",
            "headers": {},
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/RainbowTransferProcess"
                  }
                }
              }
            }
          },
          "5XX": {
            "description": "Error by retrieving all transfer processes in provider"
          }
        }
      }
    },
    "/api/v1/transfers/{transfer_id}": {
      "parameters": [
        {
          "name": "transfer_id",
          "in": "path",
          "required": true,
          "description": "The ID of the transfer to retrieve",
          "schema": {
            "type": "string",
            "pattern": "^urn:uuid:[0-9a-fA-F-]{36}$"
          }
        }
      ],
      "get": {
        "summary": "Retrieves transfer processes in provider by id",
        "operationId": "rainbow_entities/get_transfer_by_id",
        "tags": [
          "Transfer Process",
          "Rainbow",
          "Provider"
        ],
        "security": [],
        "description": "Retrieves transfer processes in provider by id",
        "responses": {
          "200": {
            "description": "Retrieves transfer processes in provider by id",
            "headers": {},
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RainbowTransferProcess"
                }
              }
            }
          },
          "404": {
            "description": "Error not transfer process to be found",
            "headers": {},
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RainbowTransferError"
                }
              }
            }
          },
          "5XX": {
            "description": "Error by retrieving all transfer processes in provider",
            "headers": {},
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RainbowTransferError"
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/transfers/{transfer_id}/messages": {
      "parameters": [
        {
          "$ref": "#/components/parameters/transfer_id"
        }
      ],
      "get": {
        "summary": "Retrieves transfer messages in provider by id",
        "operationId": "rainbow_entities/handle_get_messages_by_transfer",
        "tags": [
          "Transfer Process",
          "Provider",
          "Rainbow"
        ],
        "security": [],
        "description": "Retrieves transfer messages in provider by id",
        "responses": {
          "200": {
            "description": "Retrieves transfer messages in provider by id",
            "headers": {},
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/RainbowTransferMessage"
                  }
                }
              }
            }
          },
          "4XX": {
            "description": "Error not transfer process to be found",
            "headers": {},
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RainbowTransferError"
                }
              }
            }
          },
          "5XX": {
            "description": "Error by retrieving all transfer processes in provider",
            "headers": {},
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RainbowTransferError"
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/transfers/{transfer_id}/messages/{message_id}": {
      "parameters": [
        {
          "$ref": "#/components/parameters/transfer_id"
        },
        {
          "$ref": "#/components/parameters/message_id"
        }
      ],
      "get": {
        "summary": "Retrieves transfer message by provider and message id",
        "operationId": "rainbow_entities/get_messages_by_id",
        "tags": [
          "Transfer Process",
          "Provider",
          "Rainbow"
        ],
        "security": [],
        "description": "Retrieves transfer message by provider and message id",
        "responses": {
          "200": {
            "description": "Retrieves transfer message by provider and message id",
            "headers": {},
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RainbowTransferMessage"
                }
              }
            }
          },
          "4XX": {
            "description": "Error not transfer process to be found or message",
            "headers": {},
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RainbowTransferError"
                }
              }
            }
          },
          "5XX": {
            "description": "Error by retrieving all transfer processes in provider",
            "headers": {},
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RainbowTransferError"
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/transfers/rpc/setup-start": {
      "post": {
        "summary": "Creates a transfer start message and sends it to consumer, if works, establishes data plane and persist process and messages",
        "operationId": "ds_rcp_transfer_provider/setup_start",
        "tags": [
          "Transfer Process",
          "Provider",
          "RPC"
        ],
        "security": [],
        "description": "Creates a transfer start message and sends it to consumer, if works, establishes data plane and persist process and messages",
        "requestBody": {
          "$ref": "#/components/schemas/DSRPCTransferProviderStartRequest"
        },
        "responses": {
          "201": {
            "description": "Consumer returns TransferProcess message and start process is persisted",
            "headers": {},
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/DSRPCTransferProviderStartResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/transfers/rpc/setup-suspension": {
      "post": {
        "summary": "Creates a transfer suspension message and sends it to consumer, if works, establishes data plane and persist process and messages",
        "operationId": "ds_rcp_transfer_provider/setup_suspension",
        "tags": [
          "Transfer Process",
          "Provider",
          "RPC"
        ],
        "security": [],
        "description": "Creates a transfer suspension message and sends it to consumer, if works, establishes data plane and persist process and messages",
        "requestBody": {
          "$ref": "#/components/schemas/DSRPCTransferProviderSuspensionRequest"
        },
        "responses": {
          "201": {
            "description": "Consumer returns TransferProcess message and suspension process is persisted",
            "headers": {},
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/DSRPCTransferProviderSuspensionResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/transfers/rpc/setup-completion": {
      "post": {
        "summary": "Creates a transfer completion message and sends it to consumer, if works, establishes data plane and persist process and messages",
        "operationId": "ds_rcp_transfer_provider/setup_completion",
        "tags": [
          "Transfer Process",
          "Provider",
          "RPC"
        ],
        "security": [],
        "description": "Creates a transfer completion message and sends it to consumer, if works, establishes data plane and persist process and messages",
        "requestBody": {
          "$ref": "#/components/schemas/DSRPCTransferProviderCompletionRequest"
        },
        "responses": {
          "201": {
            "description": "Consumer returns TransferProcess message and completion process is persisted",
            "headers": {},
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/DSRPCTransferProviderCompletionResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/transfers/rpc/setup-termination": {
      "post": {
        "summary": "Creates a transfer termination message and sends it to consumer, if works, establishes data plane and persist process and messages",
        "operationId": "ds_rcp_transfer_provider/setup_termination",
        "tags": [
          "Transfer Process",
          "Provider",
          "RPC"
        ],
        "security": [],
        "description": "Creates a transfer termination message and sends it to consumer, if works, establishes data plane and persist process and messages",
        "requestBody": {
          "$ref": "#/components/schemas/DSRPCTransferProviderTerminationRequest"
        },
        "responses": {
          "201": {
            "description": "Consumer returns TransferProcess message and termination process is persisted",
            "headers": {},
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/DSRPCTransferProviderTerminationResponse"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "parameters": {
      "transfer_id": {
        "name": "transfer_id",
        "in": "path",
        "required": true,
        "description": "The ID of the transfer to retrieve",
        "schema": {
          "type": "string",
          "pattern": "^urn:uuid:[0-9a-fA-F-]{36}$"
        }
      },
      "message_id": {
        "name": "message_id",
        "in": "path",
        "required": true,
        "description": "The ID of the message to retrieve",
        "schema": {
          "type": "string",
          "pattern": "^urn:uuid:[0-9a-fA-F-]{36}$"
        }
      }
    },
    "schemas": {
      "RainbowTransferProcess": {
        "type": "object",
        "description": "Rainbow entity transfer process",
        "properties": {
          "provider_pid": {
            "type": "string",
            "nullable": false,
            "pattern": "^urn:uuid:[0-9a-fA-F-]{36}$",
            "description": "urn:uuid scheme with unique provider pid identifier",
            "example": "urn:uuid:221e21b0-e295-469a-bbc7-8565acd7d8e6"
          },
          "consumer_pid": {
            "type": "string",
            "nullable": false,
            "pattern": "^urn:uuid:[0-9a-fA-F-]{36}$",
            "description": "urn:uuid scheme with unique consumer pid identifier",
            "example": "urn:uuid:221e21b0-e295-469a-bbc7-8565acd7d8e6"
          },
          "agreement_pid": {
            "type": "string",
            "nullable": false,
            "pattern": "^urn:uuid:[0-9a-fA-F-]{36}$",
            "description": "urn:uuid scheme with unique agreement id identifier",
            "example": "urn:uuid:221e21b0-e295-469a-bbc7-8565acd7d8e6"
          },
          "data_plane_pid": {
            "type": "string",
            "nullable": false,
            "pattern": "^urn:uuid:[0-9a-fA-F-]{36}$",
            "description": "urn:uuid scheme with unique data plane id identifier",
            "example": "urn:uuid:221e21b0-e295-469a-bbc7-8565acd7d8e6"
          },
          "state": {
            "type": "string",
            "nullable": false,
            "description": "Transfer process current state",
            "enum": [
              "REQUESTED",
              "STARTED",
              "SUSPENDED",
              "COMPLETED",
              "TERMINATED"
            ],
            "example": "REQUESTED"
          },
          "created_at": {
            "type": "string",
            "nullable": false,
            "description": "Transfer process creation timestamp",
            "format": "date-time",
            "example": "2025-03-07T09:56:28.105105"
          },
          "updated_at": {
            "type": "string",
            "nullable": true,
            "description": "Transfer process updating timestamp",
            "format": "date-time",
            "example": "2025-03-07T09:56:28.105105"
          }
        },
        "required": [
          "provider_pid",
          "consumer_pid",
          "agreement_pid",
          "data_plane_pid",
          "state",
          "created_at",
          "updated_at"
        ]
      },
      "RainbowTransferMessage": {
        "type": "object",
        "description": "Rainbow entity transfer message",
        "properties": {
          "id": {
            "type": "string",
            "nullable": false,
            "pattern": "^urn:uuid:[0-9a-fA-F-]{36}$",
            "description": "urn:uuid scheme with unique provider pid identifier",
            "example": "urn:uuid:221e21b0-e295-469a-bbc7-8565acd7d8e6"
          },
          "transfer_process_id": {
            "type": "string",
            "nullable": false,
            "pattern": "^urn:uuid:[0-9a-fA-F-]{36}$",
            "description": "urn:uuid scheme with unique consumer pid identifier",
            "example": "urn:uuid:221e21b0-e295-469a-bbc7-8565acd7d8e6"
          },
          "created_at": {
            "type": "string",
            "nullable": false,
            "description": "Transfer message creation timestamp",
            "format": "date-time",
            "example": "2025-03-07T09:56:28.105105"
          },
          "message_type": {
            "type": "string",
            "nullable": false,
            "description": "Transfer message type",
            "enum": [
              "TransferRequestMessage",
              "TransferStartMessage",
              "TransferSuspensionMessage",
              "TransferCompletionMessage",
              "TransferTerminationMessage"
            ],
            "example": "TransferRequestMessage"
          },
          "from": {
            "type": "string",
            "nullable": false,
            "description": "Message sent by",
            "enum": [
              "Provider",
              "Consumer"
            ],
            "example": "Provider"
          },
          "to": {
            "type": "string",
            "nullable": false,
            "description": "Message sent to",
            "enum": [
              "Provider",
              "Consumer"
            ],
            "example": "Consumer"
          },
          "content": {
            "type": "object",
            "nullable": false,
            "pattern": "^urn:uuid:[0-9a-fA-F-]{36}$",
            "description": "Message content",
            "example": {
              "@context": [
                "https://w3id.org/dspace/2025/1/context.jsonld"
              ],
              "@type": "TransferRequestMessage",
              "agreementId": "urn:uuid:5c758db2-cf27-400e-8e30-634eb4c12022",
              "callbackAddress": "",
              "consumerPid": "urn:uuid:2b4436b2-6663-45f0-9fae-7b0b80be1b48",
              "format": "http+pull"
            }
          }
        },
        "required": [
          "id",
          "transfer_process_id",
          "created_at",
          "message_type",
          "from",
          "to",
          "content"
        ]
      },
      "RainbowTransferError": {
        "type": "object",
        "description": "Rainbow entity transfer process error",
        "properties": {
          "error": {
            "type": "object",
            "nullable": false,
            "properties": {
              "code": {
                "type": "string",
                "description": "Numeric code for error",
                "nullable": false,
                "example": "400"
              },
              "title": {
                "type": "string",
                "description": "Textual code for error",
                "nullable": false,
                "example": "BAD_REQUEST"
              },
              "message": {
                "type": "string",
                "description": "Textual description for error",
                "nullable": false,
                "example": "Error from deserializing path. Identifiers must have urn:uuid:<uuid> schema"
              }
            },
            "required": [
              "code",
              "title",
              "message"
            ]
          }
        },
        "required": [
          "error"
        ]
      },
      "DSRPCTransferProviderStartRequest": {
        "type": "object",
        "description": "Request to start a transfer provider process",
        "additionalProperties": false,
        "properties": {
          "consumerCallbackAddress": {
            "type": "string",
            "example": "https://callback.example.com"
          },
          "providerPid": {
            "type": "string",
            "pattern": "^urn:uuid:[0-9a-fA-F-]{36}$"
          },
          "consumerPid": {
            "type": "string",
            "pattern": "^urn:uuid:[0-9a-fA-F-]{36}$"
          },
          "dataAddress": {
            "$ref": "#/components/schemas/DataAddress",
            "nullable": true
          }
        },
        "required": [
          "consumerCallbackAddress",
          "providerPid",
          "consumerPid"
        ]
      },
      "DSRPCTransferProviderStartResponse": {
        "type": "object",
        "description": "Response to start a transfer provider process",
        "properties": {
          "providerPid": {
            "type": "string",
            "pattern": "^urn:uuid:[0-9a-fA-F-]{36}$"
          },
          "consumerPid": {
            "type": "string",
            "pattern": "^urn:uuid:[0-9a-fA-F-]{36}$"
          },
          "message": {
            "$ref": "#/components/schemas/TransferProcessMessage"
          },
          "dataAddress": {
            "$ref": "#/components/schemas/DataAddress",
            "nullable": true
          }
        },
        "required": [
          "providerPid",
          "consumerPid",
          "message"
        ]
      },
      "DSRPCTransferProviderSuspensionRequest": {
        "type": "object",
        "description": "Request to suspend a transfer provider process",
        "additionalProperties": false,
        "properties": {
          "consumerCallbackAddress": {
            "type": "string",
            "example": "https://callback.example.com"
          },
          "providerPid": {
            "type": "string",
            "pattern": "^urn:uuid:[0-9a-fA-F-]{36}$"
          },
          "consumerPid": {
            "type": "string",
            "pattern": "^urn:uuid:[0-9a-fA-F-]{36}$"
          },
          "code": {
            "type": "string",
            "nullable": true
          },
          "reason": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "nullable": true
          }
        },
        "required": [
          "consumerCallbackAddress",
          "providerPid",
          "consumerPid"
        ]
      },
      "DSRPCTransferProviderSuspensionResponse": {
        "type": "object",
        "description": "Response to suspend a transfer provider process",
        "properties": {
          "providerPid": {
            "type": "string",
            "pattern": "^urn:uuid:[0-9a-fA-F-]{36}$"
          },
          "consumerPid": {
            "type": "string",
            "pattern": "^urn:uuid:[0-9a-fA-F-]{36}$"
          },
          "message": {
            "$ref": "#/components/schemas/TransferProcessMessage"
          }
        },
        "required": [
          "providerPid",
          "consumerPid",
          "message"
        ]
      },
      "DSRPCTransferProviderCompletionRequest": {
        "type": "object",
        "description": "Request to complete a transfer provider process",
        "additionalProperties": false,
        "properties": {
          "consumerCallbackAddress": {
            "type": "string"
          },
          "providerPid": {
            "type": "string",
            "pattern": "^urn:uuid:[0-9a-fA-F-]{36}$"
          },
          "consumerPid": {
            "type": "string",
            "pattern": "^urn:uuid:[0-9a-fA-F-]{36}$"
          }
        },
        "required": [
          "consumerCallbackAddress",
          "providerPid",
          "consumerPid"
        ]
      },
      "DSRPCTransferProviderCompletionResponse": {
        "type": "object",
        "description": "Response after completing transfer provider process",
        "properties": {
          "providerPid": {
            "type": "string",
            "pattern": "^urn:uuid:[0-9a-fA-F-]{36}$"
          },
          "consumerPid": {
            "type": "string",
            "pattern": "^urn:uuid:[0-9a-fA-F-]{36}$"
          },
          "message": {
            "$ref": "#/components/schemas/TransferProcessMessage"
          }
        },
        "required": [
          "providerPid",
          "consumerPid",
          "message"
        ]
      },
      "DSRPCTransferProviderErrorResponse": {
        "type": "object",
        "description": "Error response for transfer provider process",
        "additionalProperties": false,
        "properties": {
          "providerPid": {
            "type": "string",
            "pattern": "^urn:uuid:[0-9a-fA-F-]{36}$",
            "nullable": true
          },
          "consumerPid": {
            "type": "string",
            "pattern": "^urn:uuid:[0-9a-fA-F-]{36}$"
          },
          "error": {
            "$ref": "#/components/schemas/TransferProcessMessage"
          }
        },
        "required": [
          "consumerPid",
          "message"
        ]
      },
      "DSRPCTransferProviderTerminationRequest": {
        "type": "object",
        "description": "Request to suspend a transfer provider process",
        "additionalProperties": false,
        "properties": {
          "consumerCallbackAddress": {
            "type": "string",
            "example": "https://callback.example.com"
          },
          "providerPid": {
            "type": "string",
            "pattern": "^urn:uuid:[0-9a-fA-F-]{36}$"
          },
          "consumerPid": {
            "type": "string",
            "pattern": "^urn:uuid:[0-9a-fA-F-]{36}$"
          },
          "code": {
            "type": "string",
            "nullable": true
          },
          "reason": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "nullable": true
          }
        },
        "required": [
          "consumerCallbackAddress",
          "providerPid",
          "consumerPid"
        ]
      },
      "DSRPCTransferProviderTerminationResponse": {
        "type": "object",
        "description": "Response to suspend a transfer provider process",
        "properties": {
          "providerPid": {
            "type": "string",
            "pattern": "^urn:uuid:[0-9a-fA-F-]{36}$"
          },
          "consumerPid": {
            "type": "string",
            "pattern": "^urn:uuid:[0-9a-fA-F-]{36}$"
          },
          "message": {
            "$ref": "#/components/schemas/TransferProcessMessage"
          }
        },
        "required": [
          "providerPid",
          "consumerPid",
          "message"
        ]
      },
      "DataAddress": {
        "type": "object",
        "description": "Data address details",
        "additionalProperties": false,
        "properties": {
          "endpointType": {
            "type": "string",
            "description": "Endpoint type definition"
          },
          "endpoint": {
            "type": "string"
          },
          "endpointProperties": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/EndpointProperty"
            }
          }
        },
        "required": [
          "endpointType",
          "endpoint",
          "endpointProperties"
        ]
      },
      "EndpointProperty": {
        "type": "object",
        "description": "Properties for endpoint",
        "additionalProperties": false,
        "properties": {
          "key": {
            "type": "string"
          },
          "value": {
            "type": "string"
          }
        },
        "required": [
          "key",
          "value"
        ]
      },
      "TransferProcessMessage": {
        "type": "object",
        "description": "DSProtocol process message definition",
        "additionalProperties": false,
        "properties": {
          "context": {
            "type": "string",
            "description": "context field"
          },
          "type": {
            "type": "string",
            "nullable": false,
            "description": "Transfer message type",
            "enum": [
              "TransferRequestMessage",
              "TransferStartMessage",
              "TransferSuspensionMessage",
              "TransferCompletionMessage",
              "TransferTerminationMessage"
            ],
            "example": "TransferRequestMessage"
          },
          "providerPid": {
            "type": "string",
            "pattern": "^urn:uuid:[0-9a-fA-F-]{36}$",
            "nullable": true
          },
          "consumerPid": {
            "type": "string",
            "pattern": "^urn:uuid:[0-9a-fA-F-]{36}$",
            "nullable": true
          },
          "state": {
            "type": "string",
            "nullable": false,
            "description": "Transfer process current state",
            "enum": [
              "REQUESTED",
              "STARTED",
              "SUSPENDED",
              "COMPLETED",
              "TERMINATED"
            ],
            "example": "REQUESTED"
          }
        }
      }
    }
  }
}
